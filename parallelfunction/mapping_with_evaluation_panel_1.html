<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Alphabet Systems f(x), g(x) and Cosine Sound</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      color: #000000;
    }
    .container {
      max-width: 600px;
      min-width: 320px;
      margin: 0 auto;
      padding: 16px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    h1, h2 {
      font-size: 18px;
      margin: 8px 0;
      text-align: center;
    }
    h2 {
      font-size: 14px;
      text-align: left;
      margin-top: 14px;
    }
    p.desc {
      font-size: 12px;
      line-height: 1.4;
      margin: 0 0 12px;
    }
    .letter-strip {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 12px;
      justify-content: center;
    }
    .letter-btn {
      border: 1px solid #333;
      padding: 2px 6px;
      font-size: 11px;
      cursor: pointer;
      background: #f7f7f7;
      border-radius: 3px;
      user-select: none;
    }
    .letter-btn.active {
      background: #000000;
      color: #ffffff;
    }
    .selected-box {
      border: 1px solid #999;
      padding: 8px;
      margin-bottom: 12px;
      font-size: 12px;
      background: #fafafa;
    }
    .selected-box div {
      margin: 2px 0;
    }
    .selected-label {
      font-weight: bold;
    }
    .eval-panel,
    .sound-panel {
      border: 1px solid #999;
      padding: 8px;
      margin-bottom: 12px;
      font-size: 12px;
      background: #fdfdfd;
    }
    .eval-panel label,
    .sound-panel label {
      display: block;
      margin: 4px 0;
      font-size: 12px;
    }
    .eval-panel input {
      width: 100%;
      padding: 4px;
      box-sizing: border-box;
      font-size: 12px;
    }
    .eval-panel button,
    .sound-panel button {
      margin-top: 6px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      border-radius: 3px;
      border: 1px solid #333;
      background: #f3f3f3;
    }
    .eval-output,
    .sound-info {
      margin-top: 6px;
      font-size: 11px;
      line-height: 1.4;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #f0f0f0;
    }
    .letter-col {
      width: 10%;
      text-align: center;
      font-weight: bold;
    }
    .footer-note {
      font-size: 10px;
      margin-top: 10px;
      color: #333;
    }
    @media print {
      .letter-btn {
        border: 1px solid #000;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Alphabet Systems f(x), g(x) and Cosine Sound</h1>
  <p class="desc">
    Each letter A through Z is assigned a pair of equations in two systems,
    <strong>f(x)</strong> and <strong>g(x)</strong>. Select a letter to see its
    symbolic equations, evaluate them at a chosen x, and generate a cosine-based
    sound where the amplitude comes from f(x) and the frequency comes from g(x).
  </p>

  <!-- Letter selector -->
  <div class="letter-strip" id="letterStrip">
    <!-- buttons generated by script -->
  </div>

  <!-- Selected letter display -->
  <div class="selected-box" id="selectedBox">
    <div><span class="selected-label">Letter:</span> <span id="selLetter">A</span></div>
    <div><span class="selected-label">f(x):</span> <span id="selF">f(x) = x + 1</span></div>
    <div><span class="selected-label">g(x):</span> <span id="selG">g(x) = 1/x</span></div>
  </div>

  <!-- Evaluation panel -->
  <div class="eval-panel">
    <h2>Evaluate f(x) and g(x)</h2>
    <p class="desc">
      The active letter is the one highlighted in the strip above. Enter a numeric value
      for x and press Evaluate to see f(x) and g(x) and to prepare sound parameters
      for the cosine mapping.
    </p>
    <label for="xInput">
      x value:
    </label>
    <input type="number" id="xInput" step="0.1" value="1">
    <button id="evalButton">Evaluate for current letter</button>
    <div class="eval-output" id="evalOutput">
      Waiting for evaluation. Choose a letter and press Evaluate.
    </div>
  </div>

  <!-- Cosine sound panel -->
  <div class="sound-panel">
    <h2>Cosine Sound Mapping: y(t) = A cos(2π f t)</h2>
    <p class="desc">
      After evaluation, the system derives an amplitude A from f(x) and a frequency f (in Hz)
      from g(x). Press the button to hear a short tone generated from the current letter
      and x value.
    </p>
    <button id="playButton">Play tone from current letter and x</button>
    <div class="sound-info" id="soundInfo">
      Sound parameters are not ready yet. Evaluate f(x) and g(x) first.
    </div>
  </div>

  <!-- Full reference table -->
  <table>
    <thead>
      <tr>
        <th class="letter-col">Letter</th>
        <th>f(x)</th>
        <th>g(x)</th>
      </tr>
    </thead>
    <tbody id="eqTableBody">
      <!-- rows generated by script -->
    </tbody>
  </table>

  <div class="footer-note">
    Note: Functions use standard notation such as sin(x), cos(x), ln(x), e^x,
    tanh(x), and so on. Evaluation uses JavaScript Math functions and will report
    an error if x is outside the domain of a given function.
  </div>
</div>

<script>
  // Data for f(x) and g(x) for letters A to Z.
  // Each entry has:
  //   letter:  display letter
  //   fStr:    display string for f(x)
  //   gStr:    display string for g(x)
  //   f(x):    numeric implementation
  //   g(x):    numeric implementation
  const eqData = [
    {
      letter: "A",
      fStr: "f(x) = x + 1",
      gStr: "g(x) = 1/x",
      f: function (x) { return x + 1; },
      g: function (x) { return x === 0 ? NaN : 1 / x; }
    },
    {
      letter: "B",
      fStr: "f(x) = x\u00b2 + 2",
      gStr: "g(x) = 2x - x\u00b2",
      f: function (x) { return x * x + 2; },
      g: function (x) { return 2 * x - x * x; }
    },
    {
      letter: "C",
      fStr: "f(x) = 3x - 2",
      gStr: "g(x) = 3sin(x)",
      f: function (x) { return 3 * x - 2; },
      g: function (x) { return 3 * Math.sin(x); }
    },
    {
      letter: "D",
      fStr: "f(x) = x\u00b3 - 3x",
      gStr: "g(x) = 4cos(x)",
      f: function (x) { return x * x * x - 3 * x; },
      g: function (x) { return 4 * Math.cos(x); }
    },
    {
      letter: "E",
      fStr: "f(x) = \u221a(x + 4)",
      gStr: "g(x) = 5e^{-x}",
      f: function (x) { return x + 4 < 0 ? NaN : Math.sqrt(x + 4); },
      g: function (x) { return 5 * Math.exp(-x); }
    },
    {
      letter: "F",
      fStr: "f(x) = |x| + 5",
      gStr: "g(x) = 6ln(x + 1)",
      f: function (x) { return Math.abs(x) + 5; },
      g: function (x) { return x + 1 <= 0 ? NaN : 6 * Math.log(x + 1); }
    },
    {
      letter: "G",
      fStr: "f(x) = sin(x) + 6",
      gStr: "g(x) = 7x\u00b3",
      f: function (x) { return Math.sin(x) + 6; },
      g: function (x) { return 7 * x * x * x; }
    },
    {
      letter: "H",
      fStr: "f(x) = cos(x) - 7",
      gStr: "g(x) = 8/(x\u00b2 + 1)",
      f: function (x) { return Math.cos(x) - 7; },
      g: function (x) { return 8 / (x * x + 1); }
    },
    {
      letter: "I",
      fStr: "f(x) = ln(x + 8)",
      gStr: "g(x) = 9\u221ax",
      f: function (x) { return x + 8 <= 0 ? NaN : Math.log(x + 8); },
      g: function (x) { return x < 0 ? NaN : 9 * Math.sqrt(x); }
    },
    {
      letter: "J",
      fStr: "f(x) = e^x - 9",
      gStr: "g(x) = 10x\u00b2 + sin(x)",
      f: function (x) { return Math.exp(x) - 9; },
      g: function (x) { return 10 * x * x + Math.sin(x); }
    },
    {
      letter: "K",
      fStr: "f(x) = tan(x) + 10",
      gStr: "g(x) = 11e^{x/2}",
      f: function (x) { return Math.tan(x) + 10; },
      g: function (x) { return 11 * Math.exp(x / 2); }
    },
    {
      letter: "L",
      fStr: "f(x) = x\u00b2 / 11",
      gStr: "g(x) = 12tan(x/2)",
      f: function (x) { return x * x / 11; },
      g: function (x) { return 12 * Math.tan(x / 2); }
    },
    {
      letter: "M",
      fStr: "f(x) = x\u00b3 / 12 - x",
      gStr: "g(x) = 13x\u2074 - x\u00b2",
      f: function (x) { return x * x * x / 12 - x; },
      g: function (x) { return 13 * x * x * x * x - x * x; }
    },
    {
      letter: "N",
      fStr: "f(x) = x\u00b2 - 13x + 13",
      gStr: "g(x) = 14cos(2x)",
      f: function (x) { return x * x - 13 * x + 13; },
      g: function (x) { return 14 * Math.cos(2 * x); }
    },
    {
      letter: "O",
      fStr: "f(x) = sin(\u03c0x / 14)",
      gStr: "g(x) = 15/(x + 2)",
      f: function (x) { return Math.sin(Math.PI * x / 14); },
      g: function (x) { return x === -2 ? NaN : 15 / (x + 2); }
    },
    {
      letter: "P",
      fStr: "f(x) = log\u2082(x + 15)",
      gStr: "g(x) = 16x\u00b3 - 4x",
      f: function (x) { return x + 15 <= 0 ? NaN : Math.log2(x + 15); },
      g: function (x) { return 16 * x * x * x - 4 * x; }
    },
    {
      letter: "Q",
      fStr: "f(x) = \u221a(x\u00b2 + 16)",
      gStr: "g(x) = 17sin(x\u00b2)",
      f: function (x) { return Math.sqrt(x * x + 16); },
      g: function (x) { return 17 * Math.sin(x * x); }
    },
    {
      letter: "R",
      fStr: "f(x) = e^{-x / 17}",
      gStr: "g(x) = 18\u221a(x\u00b2 + 1)",
      f: function (x) { return Math.exp(-x / 17); },
      g: function (x) { return 18 * Math.sqrt(x * x + 1); }
    },
    {
      letter: "S",
      fStr: "f(x) = 18/(x + 1)",
      gStr: "g(x) = 19log\u2081\u2080(x + 3)",
      f: function (x) { return x === -1 ? NaN : 18 / (x + 1); },
      g: function (x) {
        if (x + 3 <= 0) return NaN;
        return 19 * Math.log10(x + 3);
      }
    },
    {
      letter: "T",
      fStr: "f(x) = cosh(x / 19)",
      gStr: "g(x) = 20cosh(x)",
      f: function (x) { return Math.cosh(x / 19); },
      g: function (x) { return 20 * Math.cosh(x); }
    },
    {
      letter: "U",
      fStr: "f(x) = sinh(x) / 20",
      gStr: "g(x) = 21sinh(x)",
      f: function (x) { return Math.sinh(x) / 20; },
      g: function (x) { return 21 * Math.sinh(x); }
    },
    {
      letter: "V",
      fStr: "f(x) = |sin(20x)|",
      gStr: "g(x) = 22sin(3x)/x",
      f: function (x) { return Math.abs(Math.sin(20 * x)); },
      g: function (x) { return x === 0 ? NaN : 22 * Math.sin(3 * x) / x; }
    },
    {
      letter: "W",
      fStr: "f(x) = tanh(x / 21)",
      gStr: "g(x) = 23e^{-x\u00b2}",
      f: function (x) { return Math.tanh(x / 21); },
      g: function (x) { return 23 * Math.exp(-x * x); }
    },
    {
      letter: "X",
      fStr: "f(x) = (x\u2074 - 1) / 22",
      gStr: "g(x) = 24x\u00b2/(x\u00b2 + 1)",
      f: function (x) { return (x * x * x * x - 1) / 22; },
      g: function (x) { return 24 * x * x / (x * x + 1); }
    },
    {
      letter: "Y",
      fStr: "f(x) = x\u00b2 + sin(2x)",
      gStr: "g(x) = 25tan^{-1}(x)",
      f: function (x) { return x * x + Math.sin(2 * x); },
      g: function (x) { return 25 * Math.atan(x); }
    },
    {
      letter: "Z",
      fStr: "f(x) = ln(x\u00b2 + 23)",
      gStr: "g(x) = 26sin(x)cos(x)",
      f: function (x) { return x * x + 23 <= 0 ? NaN : Math.log(x * x + 23); },
      g: function (x) { return 26 * Math.sin(x) * Math.cos(x); }
    }
  ];

  const letterStrip = document.getElementById("letterStrip");
  const eqTableBody = document.getElementById("eqTableBody");
  const selLetter = document.getElementById("selLetter");
  const selF = document.getElementById("selF");
  const selG = document.getElementById("selG");
  const xInput = document.getElementById("xInput");
  const evalButton = document.getElementById("evalButton");
  const evalOutput = document.getElementById("evalOutput");
  const playButton = document.getElementById("playButton");
  const soundInfo = document.getElementById("soundInfo");

  let currentIndex = 0;

  // Last computed parameters for sound
  let lastParams = {
    letter: null,
    x: null,
    fVal: null,
    gVal: null,
    amplitude: null,
    freqHz: null
  };

  // Build letter buttons and table rows
  eqData.forEach((item, index) => {
    // Buttons
    const btn = document.createElement("button");
    btn.className = "letter-btn" + (index === 0 ? " active" : "");
    btn.textContent = item.letter;
    btn.dataset.index = index.toString();
    letterStrip.appendChild(btn);

    // Table rows
    const tr = document.createElement("tr");
    const tdL = document.createElement("td");
    const tdF = document.createElement("td");
    const tdG = document.createElement("td");

    tdL.className = "letter-col";
    tdL.textContent = item.letter;
    tdF.textContent = item.fStr;
    tdG.textContent = item.gStr;

    tr.appendChild(tdL);
    tr.appendChild(tdF);
    tr.appendChild(tdG);
    eqTableBody.appendChild(tr);
  });

  function setSelected(index) {
    currentIndex = index;
    const item = eqData[index];
    selLetter.textContent = item.letter;
    selF.textContent = item.fStr;
    selG.textContent = item.gStr;

    const buttons = document.querySelectorAll(".letter-btn");
    buttons.forEach(btn => btn.classList.remove("active"));
    buttons[index].classList.add("active");
  }

  // Initial selection
  setSelected(0);

  // Event delegation for letter buttons
  letterStrip.addEventListener("click", function (evt) {
    const target = evt.target;
    if (target.classList.contains("letter-btn")) {
      const idx = parseInt(target.dataset.index, 10);
      if (!isNaN(idx)) {
        setSelected(idx);
      }
    }
  });

  // Evaluate f(x) and g(x) for current letter and x
  evalButton.addEventListener("click", function () {
    const xVal = parseFloat(xInput.value);
    if (isNaN(xVal)) {
      evalOutput.textContent = "Please enter a valid numeric value for x.";
      lastParams = {
        letter: null, x: null, fVal: null, gVal: null, amplitude: null, freqHz: null
      };
      soundInfo.textContent = "Sound parameters are not ready. Please fix x and evaluate again.";
      return;
    }

    const item = eqData[currentIndex];
    let fVal = item.f(xVal);
    let gVal = item.g(xVal);

    if (!isFinite(fVal) || !isFinite(gVal) || isNaN(fVal) || isNaN(gVal)) {
      evalOutput.textContent =
        "The chosen x value is outside the numeric domain for this letter. " +
        "Try a different x, or a different letter.";
      lastParams = {
        letter: null, x: null, fVal: null, gVal: null, amplitude: null, freqHz: null
      };
      soundInfo.textContent = "Sound parameters are not ready because the evaluation was invalid.";
      return;
    }

    // Normalize amplitude A from f(x)
    const ampRaw = Math.abs(fVal);
    const amplitude = ampRaw / (1 + ampRaw); // In (0, 1), saturating smoothly

    // Normalize frequency from g(x)
    const gAbs = Math.abs(gVal);
    const base = gAbs < 1 ? 1 + gAbs : gAbs; // Ensure strictly positive
    const freqHz = 220 + (base % 880);       // Keep frequency between 220 and 1100 Hz

    lastParams = {
      letter: item.letter,
      x: xVal,
      fVal: fVal,
      gVal: gVal,
      amplitude: amplitude,
      freqHz: freqHz
    };

    evalOutput.textContent =
      "Letter " + item.letter + " at x = " + xVal +
      " gives:\n" +
      "  f(x) = " + fVal.toFixed(6) + "\n" +
      "  g(x) = " + gVal.toFixed(6) + "\n\n" +
      "Mapped sound parameters:\n" +
      "  Amplitude A (from f(x)) = " + amplitude.toFixed(4) + " (0 to 1)\n" +
      "  Frequency f (from g(x)) = " + freqHz.toFixed(2) + " Hz";

    soundInfo.textContent =
      "Ready to play y(t) = A cos(2π f t) for letter " + item.letter +
      " at x = " + xVal + ".\n" +
      "A = " + amplitude.toFixed(4) + ", f = " + freqHz.toFixed(2) + " Hz.";
  });

  // Web Audio setup
  let audioCtx = null;

  function getAudioContext() {
    if (!audioCtx) {
      const AC = window.AudioContext || window.webkitAudioContext;
      if (!AC) {
        alert("Web Audio API is not supported in this browser.");
        return null;
      }
      audioCtx = new AC();
    }
    return audioCtx;
  }

  // Play tone using lastParams
  playButton.addEventListener("click", function () {
    if (!lastParams || lastParams.amplitude === null || lastParams.freqHz === null) {
      alert("Sound parameters are not set. Please evaluate f(x) and g(x) first.");
      return;
    }

    const ctx = getAudioContext();
    if (!ctx) {
      return;
    }

    const duration = 2.0; // seconds
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();

    oscillator.type = "sine"; // Cosine and sine are phase-shifted; this is acceptable for tone
    oscillator.frequency.value = lastParams.freqHz;

    gainNode.gain.value = lastParams.amplitude;

    oscillator.connect(gainNode).connect(ctx.destination);

    const now = ctx.currentTime;
    oscillator.start(now);
    oscillator.stop(now + duration);
  });
</script>
</body>
</html>
